package day13

import (
	"fmt"
	"testing"
)

var (
	lightInput = [][]string{
		{
			"#.##..##.",
			"..#.##.#.",
			"##......#",
			"##......#",
			"..#.##.#.",
			"..##..##.",
			"#.#.##.#.",
		},
		{
			"#...##..#",
			"#....#..#",
			"..##..###",
			"#####.##.",
			"#####.##.",
			"..##..###",
			"#....#..#",
		},
	}

	testInput = [][]string{
		{
			"#.##.# #.##.#  #",
			"#...## ##...#  #",
			"#.##.. ..####  #",
			"###... ...###  #",
			".#.#.# #.#.#.  .",
			"###..# #..###  #",
			"#.###. .###.#  #",
		},
	}

	largeInput = [][]string{
		{
			"#.######.#.",
			"....##.#...",
			"..######...",
			"###....###.",
			"#..####..##",
			".#.#..#.#.#",
			".#.#..#.#.#",
			"##......###",
			"..........#",
			".#.####.#.#",
			".#......#.#",
			".#......#.#",
			".#.####.#.#",
		},
		{
			".##...#.#...#",
			"#######..#.#.",
			"#..#.######.#",
			"....###..##.#",
			"......##.....",
			"#..##..#...##",
			"#..####.#....",
			"###.#..##....",
			"............#",
			"#..#..#####.#",
			"#..#..#####.#",
		},
		{
			"##..#######..",
			".#.####.#.#..",
			".#.#..#..##.#",
			"...#..#.##.#.",
			"#.#..#....##.",
			"#.#..#....##.",
			"...#..#.##.#.",
			".#.#..#..##.#",
			".#.##.#.#.#..",
			"##..#######..",
			"#.#.##.#.....",
			"#.....###..#.",
			"###.....###.#",
			"###.....###.#",
			"#.....###..#.",
			"#.#.##.#.....",
			"##..#######..",
		},
		{
			"#...#.##.",
			"#...#.##.",
			"..#.#....",
			"...#.....",
			".##.##..#",
			"##...####",
			"#.#.#####",
			"#.##.#...",
			".###.....",
			"#.#.#####",
			"###.##..#",
			".#..##..#",
			".#....##.",
		},
		{
			"#..#.#.####",
			"....#..#.#.",
			".##.#..####",
			".##...#..#.",
			"####....#..",
			"#####.##.#.",
			"#####.##.#.",
			"####....#..",
			".##...#..#.",
			".##.#..####",
			".......#.#.",
			"#..#.#.####",
			"....#...##.",
			".##.##.##.#",
			"#..###.#..#",
			"#..###.#.#.",
			"....##.###.",
		},
		{
			"##.##..##",
			".##.#..#.",
			"#..##..#.",
			"#.#.#..#.",
			"....####.",
			"##..#..#.",
			".#..####.",
			".##.####.",
			"...#....#",
			"...#....#",
			".##.####.",
		},
		{
			"..#.#.##.",
			"##..#.##.",
			"##...#..#",
			"##..##..#",
			"##..##..#",
			"##...#..#",
			".#..#.##.",
			"..#.#.##.",
			"..###....",
			".#.#.####",
			".#..#.##.",
			"..##..##.",
			"###..#..#",
			"##.#.....",
			"...#.....",
		},
		{
			"######....#",
			"##..###..##",
			"#.####.##.#",
			".......##..",
			".####.#..#.",
			"......####.",
			"#....#.##.#",
			"......#..#.",
			"#....#....#",
		},
		{
			".#....###",
			"#.#######",
			"#.#######",
			".#....###",
			"..##.#...",
			".###.#.##",
			".#...#.##",
			"..####.##",
			"...##..#.",
		},
		{
			"##.#.#.#.####.#",
			"####.#..#....#.",
			"####.#..##..###",
			"#...###..#..#..",
			"#.#.#..#.####.#",
			"###...#.##..##.",
			".#....#.##..##.",
			".#....#.##..##.",
			"###...#.##..##.",
		},
		{
			"######.##.#.##..#",
			"..##..#.#..#..#.#",
			"..##......#.#..##",
			".......##.##.#.##",
			"..##..##....#...#",
			"########..#####.#",
			"#....#.###.#...#.",
			"#########..#.#..#",
			"######..#.#.###.#",
		},
		{
			"####.#.###.#.##",
			"...##.#..##.###",
			"#.##.#..##.#.##",
			".##..##.######.",
			"#.#...#.#..##.#",
			".......##..##.#",
			"#.###......#.#.",
			"#.###......#.#.",
			".......##..##.#",
			"#.#...#.#..##.#",
			".##...#.######.",
			"#.##.#..##.#.##",
			"...##.#..##.###",
			"####.#.###.#.##",
			"####.#.###.#.##",
		},
		{
			"..####.##",
			"....#.#..",
			"..#......",
			"....#..#.",
			"####..#..",
			"###....#.",
			"###..##.#",
			"###...#..",
			"###.#...#",
			"###.#...#",
			"###.#.#..",
			"###..##.#",
			"###....#.",
			"####..#..",
			"....#..#.",
		},
		{
			"###...#...#",
			"###..#..#.#",
			".#.##.#..##",
			".#.#..##.##",
			"#...##.#..#",
			".##.....#..",
			"..#..######",
			".....#.##.#",
			".#..#.###.#",
			"#.#.#.#.#..",
			"#.#.###.#..",
			"#.#.###.#..",
			"#.#.#.#.#..",
		},
		{
			".##.#..####.#.#..",
			"###..#..###.#.###",
			"##..###.....#..##",
			"#........###..###",
			"###.####..##.....",
			"###.#.#....##.#..",
			"###.#.#....##.#..",
			"###.####..##.....",
			"#........###..###",
			"##..###.....#..##",
			"###..#..###.#.###",
			".##.#..####.#.#..",
			"......#..####.##.",
			"##.#.#######.#...",
			"#..#.#..#.#.#####",
			"#....#.##.##..#..",
			".#....##..#......",
		},
		{
			"...##..#.######.#",
			".######...#..#...",
			"..#.#.#.##...###.",
			"...#.#.#........#",
			"##...#.#..####..#",
			".##.##.###....###",
			"..#...###......##",
			"###.#.#.#.#..#.#.",
			".#.#..#..#.##.#..",
			".##.#..###....###",
			"#.#...##.#....#.#",
			"####.#.##..##..##",
			"####.#.##..##..##",
			"#.#...##.#....#.#",
			".##.#..###....###",
			".#.#..#..#.##.#..",
			"###.#.#.#.#..#.#.",
		},
		{
			"........#######",
			"#######.#######",
			"#..###..#######",
			"....#..#.#..##.",
			".##.#.#.#.#.##.",
			"##.##..##.#....",
			"#..#.#...######",
			".....#.#..##..#",
			"##########.####",
			".##.#.##.#.####",
			"#..#...####.##.",
			"#..##.##..#.##.",
			".##.#.....##..#",
			"#..##..##.#####",
			".....##..##....",
		},
		{
			"#..####.##.##",
			".##.##.####.#",
			"#######.##.##",
			"####.........",
			"#..##..####..",
			"....##.#..#.#",
			".##..#.####.#",
			"....#.#....#.",
			".....##....##",
			".##.##.#..#.#",
			"#..##..#..#..",
			"####.######.#",
			".....#.####.#",
			".##.##......#",
			"#..##........",
		},
		{
			"#.#..#.",
			".######",
			".######",
			"#......",
			"...##..",
			".######",
			"...##..",
			"###..##",
			".######",
		},
		{
			"##.#..#.##...",
			".##.##.##.#..",
			"...####.....#",
			"##..##..###.#",
			".#......#.##.",
			"..##..##...#.",
			"....##.....#.",
			".##.##.##.#.#",
			"#.#.##...#.#.",
			"##.#..#.#####",
			"###....###.#.",
			"..######....#",
			"###....####..",
			"....##.....#.",
			"...####...#.#",
			"###.##.###...",
			"###.##.###...",
		},
		{
			".##.######..#",
			".##.######..#",
			".#.###.####..",
			".####.##..###",
			"...#..###.###",
			"###.....#..#.",
			"..##.#.##..#.",
			"..#.##..##.#.",
			".#..#.#.....#",
			".#..#.#.....#",
			"..#.##..##.#.",
			"..##.#.##..#.",
			"###.....#..#.",
			"...#..###.###",
			".####.##..###",
			".#.###.####..",
			".##..#####..#",
		},
		{
			".##.##..#",
			".#..####.",
			".#..####.",
			".#####..#",
			"#.##...#.",
			"...###..#",
			"..##.#...",
			"#.#.....#",
			"#...#.#..",
			"#...#.#..",
			"#.#.....#",
			"..##.#...",
			"...###..#",
			"#.##...#.",
			".#####..#",
		},
		{
			"##..###..#...#.",
			"#...###..#...#.",
			".#.#...##..####",
			"#..#.##....#.##",
			".##.##.....####",
			"...###.###.#.#.",
			"#..#.####...#.#",
			".#..###...#....",
			"....#.#######..",
			".#.#.#.##...###",
			".#.#.#.##...###",
		},
		{
			".##...#..#...##..",
			"##..########..###",
			"##..#..##..#..###",
			"...##.#..#.##....",
			".#...##..##...#..",
			"..##........##...",
			"##.###....###.###",
			"..##...##...##...",
			"######....##.####",
			"...##.#..#.##....",
			".....#....#......",
			"...##......##....",
			".......##........",
		},
		{
			".##.###.#..",
			"####......#",
			".##.####.##",
			"#...##....#",
			"#.##.#.....",
			"#.##.#.....",
			"#...##....#",
			".##.####.##",
			"####......#",
			".##.###.#..",
			"#...#.#####",
			".....#.##.#",
			".....#.##.#",
			"#...#.#####",
			".##.###.#..",
			"####.#....#",
			".##.####.##",
		},
		{
			"#.##......##.#.#.",
			"..#.#....#.#.....",
			"..#.#....#.#.....",
			"#.##......##.#.#.",
			"####.#..#.####.##",
			"#.##.#..#.##.#...",
			"##...####...###.#",
			"###.#.#..#.#####.",
			"..###.##.###...##",
			"#.##.#..#.##.##.#",
			"..#..####..#....#",
			"#.##.#..#.##.#.#.",
			"#..##.##.##..#.#.",
		},
		{
			"#.####.#..###..",
			"##....###.##...",
			"..####..#.#####",
			"#.####.#....#.#",
			"#.####.#....#.#",
			"..####..#.#####",
			"##....###.##...",
			"#.####.#..###..",
			".##..##....#.##",
			"#......#.#...#.",
			"##....#####.###",
			"...##.....##.#.",
			".##..###.#.#.##",
			".######.#...###",
			".#....#....##..",
		},
		{
			"#...#.##.###.",
			"#...#.#.###.#",
			"#...#.#.###.#",
			"#...#.##.###.",
			"##.#...##.#..",
			"#.###..###.#.",
			"###.#.#..#...",
			".##..###..#.#",
			".##..###..###",
			"###.#.#..#...",
			"#.###..###.#.",
		},
		{
			"..#.#..####..##",
			"....#.#.####...",
			"..####..#.#....",
			"#######..###...",
			"...#..###.#..##",
			"##.#..#.#...###",
			"##..#..#.######",
			"##.....#.#.#.##",
			"##.###.###..###",
			"#......#.#.....",
			"..##.#.#####.##",
		},
		{
			"#.#.#..",
			"##.##..",
			"..#####",
			"..##.##",
			"..##.##",
			"..#####",
			"##.###.",
			"#.#.#..",
			"#......",
			".#....#",
			".#....#",
			"#......",
			"#.#.#..",
		},
		{
			"##.#..##..#.#",
			"..#..####..#.",
			"##...#..#...#",
			"..#.##..##.#.",
			"###..#..#..##",
			"..###.##.###.",
			"##.##....##.#",
			"##.##.##.####",
			"###.#.##.#.##",
			"##..##..##..#",
			"..#..#..#..#.",
		},
		{
			"...#.#.",
			"...#...",
			"##.#...",
			"..##.##",
			"##..#.#",
			"##..#..",
			"###..##",
			"##..#.#",
			"###....",
			"..#.##.",
			"####..#",
		},
		{
			"##...###.#.##",
			"##...###.#.##",
			"#..#..#..##..",
			".....#.###.#.",
			"#.#.#..##.###",
			"##...##.#..#.",
			"##...##.#..#.",
			"#.#.#..######",
			".....#.###.#.",
			"#..#..#..##..",
			"##...###.#.##",
		},
		{
			"....#...######.",
			"####.#.######.#",
			"#..#####.#..#.#",
			"####..#..#..#..",
			"#..#.###.####.#",
			"#..#.#..#.##.#.",
			"#..#...#......#",
			"#..#.#####..###",
			"#####.##.#..#.#",
			"####.##..####..",
			"#..#.#..##..##.",
			"#..#...##.##.##",
			".##..##########",
		},
		{
			".##..##..##..",
			".#.#.####.#..",
			".###....###..",
			"..#.#..#.#...",
			"###.#..#.####",
			"##..####..###",
			".#..####..#..",
			"##..####..###",
			".#...##...#..",
			".###....###..",
			"##.#.##.#.###",
			"##........###",
			"..#..##..#...",
		},
		{
			"..#..#....#..#..#",
			".....#....#......",
			"..##........##...",
			"#.#.#.#..#.#.#.#.",
			"..#..#....#..#...",
			"#..##..##..##..##",
			"...##.####.##....",
			"##............###",
			"##............##.",
		},
		{
			".....#.#.##.#...#",
			"#..#.#..#.##.##..",
			".#.#.##.#.#...#..",
			"..##.###..#.##.##",
			"..#.####.##.#.##.",
			"###.....#..###..#",
			"....#.##...###...",
			"....#.##...###...",
			"###.....#..###..#",
			"..#..###.##.#.##.",
			"..##.###..#.##.##",
			".#.#.##.#.#...#..",
			"#..#.#..#.##.##..",
			".....#.#.##.#...#",
			".....#.#.##.#...#",
		},
		{
			"#..#..#",
			"##.##.#",
			"#....#.",
			"#....#.",
			"##.##.#",
			"#..#..#",
			".#...#.",
			"##.###.",
			"..#..#.",
			"..##.#.",
			"##.###.",
		},
		{
			".##...##.##",
			".##.#######",
			".##.###.##.",
			"####.##..#.",
			"#######.###",
			".##..#.##.#",
			"....###.###",
			"......#....",
			"#..#.###.#.",
			"#######..#.",
			"#####.#.#.#",
			".##.##..##.",
			".##.##..##.",
			"#####.#.#.#",
			"######...#.",
		},
		{
			"###..####.###",
			"##.##.##.##..",
			"##.##.##.##..",
			"###..####.###",
			"#.#..#.#.##.#",
			"#.#..#...#.##",
			"........#..#.",
		},
		{
			"..#.####..##..#",
			".#..#.#........",
			".#..##.........",
			"#....##........",
			"...#.###..##..#",
			"...##.#.##..##.",
			".##.#..........",
			"..#..#.#..##..#",
			"...#.##.##..##.",
			"#...#..#..##..#",
			".#.....###..###",
			".#..#..........",
			"#.####.........",
		},
		{
			"..#.##....#",
			"##.##..#.##",
			".#.#..#....",
			"#####.#....",
			"###.#...###",
			"###.####.##",
			"##.....####",
			"..#.##.##..",
			"..#.##.##..",
			"##.....####",
			"###.####.##",
			"###.#...###",
			"#####.#....",
			".#.#..#....",
			"##.##..#.##",
		},
		{
			"#.##.##.##.#...",
			"#####..#####.##",
			"..#..##..#..#..",
			".####..####.#..",
			"#.#......#.#...",
			"#.#.####.#.#.#.",
			".....##........",
			".##..##..##.#..",
			"#.#..##..#.####",
			"#..#.##.#..####",
			".#.##..##.#....",
			"............###",
			".#.#....#.#.###",
			".##########....",
			"..########..###",
		},
		{
			"....#..#..#..",
			"......#....#.",
			"#####.##..##.",
			".....##..#.##",
			"#..####.##.##",
			"....#.#.##.#.",
			"#..##.#.##.#.",
			"....####..###",
			".##.#........",
			"#..#...####..",
			"......#....#.",
			"#..##........",
			"#######.##.##",
			"........##...",
			".....###..###",
		},
		{
			"...###..#..##..",
			"########..####.",
			"#..#..#..######",
			".##.#.###.#..#.",
			"#.###.#########",
			"..#....##.####.",
			"....##.##.####.",
			"..#............",
			"...###.........",
			"...#.##.#.#..#.",
			".#.##.##....#..",
			"##.#.#.##.#..#.",
			"###.##...#.##.#",
			"..##....#..##..",
			"#.##..#...#..#.",
			"......####....#",
			"......####....#",
		},
		{
			"#.#..##.#",
			"#.##...#.",
			"#........",
			".......#.",
			".......#.",
			"#........",
			"#.##...#.",
			"#.#..##.#",
			"..#..##..",
			".#..#..#.",
			"...#####.",
			"...#####.",
			".#..#..#.",
			"..#..##..",
			"###..##.#",
			"#.##...#.",
			"#........",
		},
		{
			".####..#.",
			"#.##.#.##",
			".####.###",
			"#....###.",
			"#....###.",
			".####.###",
			"#.##.#.##",
			".####..#.",
			".#..#.#.#",
			".......##",
			"#...##.##",
			"##..###.#",
			"#....###.",
			"######.#.",
			"##..###..",
		},
		{
			".#.###..#...###",
			".#.###......###",
			".#.###......###",
			".#.###..#...###",
			"#....###..####.",
			"..##########...",
			"###.#..##.#.##.",
			"....#.#.#.#...#",
			"###....##...##.",
			"##...#..#..##.#",
			".#.#.#.#.......",
		},
		{
			"#.####.###.###.##",
			".#....#....##....",
			"...##......#.#...",
			"#####.##.....###.",
			"..####...#.#...#.",
			".#.##.#...##..#.#",
			"#......#####...##",
			"..#..#....#.###..",
			"..#..#....#.###..",
			"#......#####...##",
			".#.##.#...##..#.#",
		},
		{
			"######.#.#..##.",
			"####...######..",
			"....###.#.##.##",
			"....#.#.#.##.##",
			"####...######..",
			"....#....######",
			"#.#..#####...#.",
			"#.#..#####...#.",
			"....#....######",
			"####...######..",
			"....#.#.#.##.##",
			"....###.#.##.##",
			"####...######..",
		},
		{
			"##....#.#.#..",
			"###...#.#.#..",
			"#..#...#....#",
			"..#.###...###",
			"#..#####.##.#",
			".#..#...#...#",
			"##..##..#####",
			".#.#..####.#.",
			"##..##.#.#.##",
			"..####.#...##",
			"..####.#...##",
		},
		{
			"#.#.#..#..#",
			"...#....##.",
			"#.#.#..####",
			"...####.##.",
			"...####.##.",
			"#.#.#..####",
			"...#..#.##.",
			"#.#.#..#..#",
			"#.#..#..##.",
			"###.#......",
			"#..#.#.#..#",
			".####..#..#",
			"#.#.####..#",
			"#..##.#....",
			"#.#..#.....",
			"##.##.#....",
			"..##..#####",
		},
		{
			"..#.###",
			"#..#...",
			".###.#.",
			"..#....",
			"#..###.",
			"#..#.#.",
			"..#....",
			".###.#.",
			"#..#...",
			"..#.###",
			"..#.###",
		},
		{
			".........#...####",
			"#######.#..#####.",
			"##..##.#.....####",
			".......##.#####.#",
			"......###.#....#.",
			"......###.#....#.",
			"#....#.##.#####.#",
			"##..##.#.....####",
			"#######.#..#####.",
			".........#...####",
			"##..##..####.....",
		},
		{
			"....#..#..#..",
			"##.#..######.",
			"##..##..##..#",
			"...##.#.##...",
			"####.#......#",
			"...#..######.",
			"....###.##.##",
			"##..#.######.",
			"...#.##....##",
			"...#....##...",
			"...##.##..##.",
			"##.####.##.##",
			"..###..####..",
		},
		{
			".###.####",
			"##...##.#",
			"..#.#.##.",
			"#.#..#.##",
			"#.#.#.##.",
			"#.#...##.",
			"####.###.",
			"####.###.",
			"#.#...##.",
			"#.#.#.##.",
			"#.#..#.##",
			"..#.#.###",
			"##...##.#",
			".###.####",
			".###.####",
		},
		{
			".####..#####.",
			"#.....#..#...",
			"#.....#..#...",
			".####.######.",
			"..#.....#..#.",
			"..##.###....#",
			"####.#.#...##",
			"..####.#.##..",
			".###...###.##",
			"###..##....#.",
			"###..##....#.",
		},
		{
			"###.#...####...",
			".##...#####..##",
			".#..##....#....",
			".###...##....##",
			".#####.#...#...",
			"....#.#...#.###",
			".####.###..#.##",
			"....###..###...",
			"....###..###...",
			".########..#.##",
			"....#.#...#.###",
		},
		{
			".##.#.#.#.#",
			"#..#..#...#",
			"....#...#..",
			"#..###.####",
			"#..##.####.",
			".....##..#.",
			"#..##.##..#",
			"####.#...#.",
			"#..#....#..",
			"#..#....#..",
			"######...#.",
		},
		{
			"#..###...",
			".##.#####",
			".......#.",
			".......#.",
			".##.#####",
			"#..###...",
			".##..#.##",
			"...#.#.#.",
			".##..###.",
			".....###.",
			"#..##.###",
			".##..###.",
			".##......",
			"#..#..#.#",
			"....###.#",
			"#..##.#.#",
			".##.#.#.#",
		},
		{
			"###.#.###........",
			".#.#..#.#........",
			".#...##..########",
			"#.####.##...##...",
			".#.#..#.###....##",
			".###.#...##....##",
			"#.#..#..#..#..#..",
			"##.#.#.#...#..#..",
			"#######...#....#.",
		},
		{
			"##.#..##.####.##.",
			"######....##....#",
			"##.####..####..##",
			"##...##.######.##",
			".....##...##...##",
			"....###...##...##",
			"..##.###..##..###",
			"...######....####",
			"##...#....##....#",
			"..#######....####",
			"...#.####....####",
			"##.......#..#....",
			"..#.##.#.#..#.#.#",
			"##.#...########..",
			"####..##.##.#.##.",
		},
		{
			".##.####...#.",
			".....#..#....",
			"#..####.#.##.",
			".##..#...#...",
			"####.##.#.#.#",
			"###.#....#..#",
			"#..#.##...#..",
			"####....#####",
			".##.##....#.#",
			"#..#..#..##..",
			"#..#..#..##..",
			".##.##....#.#",
			"####....#####",
		},
		{
			"#..#.##.#",
			"##.#.##.#",
			"...#.##.#",
			"..#######",
			".#.##..##",
			"#..##..##",
			"##.######",
			"..###..##",
			".##..###.",
			"####....#",
			"...######",
			".....##..",
			".....##..",
			"...######",
			"####....#",
			".##..###.",
			"..###..##",
		},
		{
			"####...",
			"####...",
			"##.####",
			"......#",
			"#....#.",
			"#.#...#",
			"..#....",
			"..#....",
			"#.....#",
		},
		{
			"#..#...#.",
			"##.#...#.",
			"##.#...#.",
			"#..#...#.",
			"..#.....#",
			"..##.##..",
			".#......#",
			".#.##.###",
			"###.....#",
		},
		{
			"#.####.#..##..##.",
			"########.##.##.##",
			"###..###.#.#..#.#",
			"##....####.####.#",
			"#..##..##.#....#.",
			".#.##.#.##.#..#.#",
			"...##....#.####.#",
			"#..##..########.#",
			"##....##..#....#.",
			"##....##.###..###",
			"........#..#..#..",
			".........#.####.#",
			".#.##.#..########",
			".#....#.#########",
			"##....##..#.##.#.",
		},
		{
			"##.#.....",
			"#..#.....",
			".#....#..",
			".#..##.##",
			"#...##..#",
			"#..#..#.#",
			"###.#....",
			"..##.#..#",
			"##..####.",
			"######..#",
			"######..#",
			"##..####.",
			"..##.#..#",
			"###.#....",
			"#..#..#.#",
			"#...##..#",
			".#..##.##",
		},
		{
			"#...###..####..",
			"###..#..##..##.",
			".#.....##.##.#.",
			"#.###.#.##...#.",
			"###...###.#.###",
			"###...###.#.###",
			"#.###.#.##...#.",
			".#.....##.##.#.",
			"###..#..##..##.",
			"#...##...####..",
			"###..##.#.####.",
			"#....##...#.##.",
			"#....##...#.##.",
		},
		{
			".####.####..###",
			"#.##.###.#..#.#",
			"..##...##.#..##",
			"######....##...",
			"..##.....#..#..",
			"##..##....##...",
			"#....###..##..#",
		},
		{
			".#.##.#..",
			"#.####.##",
			"#.####.##",
			".#.##.#..",
			"#.....###",
			"#.#..#.#.",
			"#.####.#.",
		},
		{
			"##.....##.#.#",
			"#.#.####.....",
			"..###......##",
			"...#.....#.##",
			"#.#..#.....#.",
			"#.##....#.###",
			"....#.##.#.#.",
			"....#.##.#.#.",
			"#.##....#.###",
			"#.#..#.....#.",
			"...#.....#.##",
			"..###......##",
			"#.#.####.....",
			"##.....#..#.#",
			"##.....#..#.#",
			"#.#.####.....",
			"..###......##",
		},
		{
			".#..#.#.##.#.##",
			".##.#####.#...#",
			".##.#####.#.#.#",
			".#..#.#.##.#.##",
			"#..#.#..#.##...",
			"....##.#.....##",
			"#.##....####.#.",
			"#..##...#.#...#",
			"....##.#####...",
			"##...#.###.....",
			".#...#..#..#.#.",
			".#...#..#..#.#.",
			"##...#.###.....",
			"....##.#####...",
			"#..##...#.#...#",
		},
		{
			"#......####.#.#.#",
			"###..#######.##..",
			"###..#######.##..",
			"#......####.#.#.#",
			"#.####.##.###.#.#",
			"#..##..###...#...",
			"...##...##...#...",
			".#.##.#..##.#.###",
			"#########.###..#.",
			"###..####.#####..",
			".##..#...##..##.#",
			"###..####.#.##...",
			"#.#..#.#.#.#..###",
			"#.####.##..#.##.#",
			".######......####",
		},
		{
			"..######...#..#",
			"#.#....#.######",
			"#.#....#.######",
			"..######...#..#",
			"..#....#...#...",
			"#..####..#.####",
			"...#..#.#.##...",
			".##.##.##.....#",
			"#..#..#..#..##.",
			"#.#.##.#.#...##",
			"..#....#.....##",
			"#.##..##.##..#.",
			".#.#..#.#..#..#",
		},
		{
			".#...##.###..#.",
			".#...##..##..#.",
			".#..#...#......",
			"##...#.####.###",
			"##.#.###.##.###",
			"..#....####..##",
			".##..#####..#..",
			"..###.#..#.###.",
			"..###.#..#.###.",
		},
		{
			".########..",
			"#..#..#..##",
			".###..###.#",
			"##.#..#.##.",
			"..#.##.#..#",
			"..#.##.#..#",
			"##.#..#.###",
			".###..###.#",
			"#..#..#..##",
			".########..",
			".#.####.#..",
			"#..#..#..##",
			"##########.",
			"...#..#...#",
			"##.####.###",
		},
		{
			"###.###",
			"#.#####",
			".#.##..",
			"#.#.#..",
			".....##",
			"..#.#..",
			"#..##..",
			"...#.##",
			"...#.##",
			"#..##..",
			"#.#.#..",
			".....##",
			"#.#.#..",
			".#.##..",
			"#.#####",
			"###.###",
			"..#.#..",
		},
		{
			"...#.#...",
			"##..#..##",
			"###.#..#.",
			"##...##.#",
			"##...#...",
			"...#.#...",
			"...#.#...",
			"##...#...",
			"##...##.#",
			"###.#.##.",
			"##..#..##",
			"...#.#...",
			"##.###.#.",
		},
		{
			"..#...####.",
			".#.##..##..",
			".###..####.",
			".#.###....#",
			"##..#..##..",
			"###..##..##",
			".....######",
			"..#..##..##",
			".###...##..",
			"###..#....#",
			"#.####.##.#",
			"#.####.##.#",
			"##...#....#",
		},
		{
			"####.#....##...",
			".##..#.###..###",
			"#..###..##..##.",
			"#..##.####..###",
			"####...##....##",
			"....#.#.#....#.",
			"#...#####....##",
		},
		{
			"####.#..#.#",
			".##..####..",
			"#..#..##..#",
			"####......#",
			"######..###",
			"#..###..###",
			"....#....#.",
			"...#..##..#",
			"#####....##",
			"#..#.#..#.#",
			"######..###",
		},
		{
			".#..#..",
			"#.#...#",
			".###..#",
			"...##..",
			".#...#.",
			".#...#.",
			"...##..",
			".###..#",
			"#.#...#",
			"....#..",
			"#.....#",
			"####.#.",
			".....##",
			".....##",
			"####.#.",
		},
		{
			"####.#..#....#..#",
			".#..#.....##.....",
			"..###..#.####.#..",
			"..##.###.#..#.###",
			"...####........##",
			".######..####..##",
			".#..#..###..###..",
			".##.###...##...##",
			"...#.###......###",
		},
		{
			"####.####",
			"##...#.##",
			"##...#.##",
			"####.####",
			"##.#.####",
			"####..###",
			"..#.##...",
			"####..#.#",
			".....#...",
			".....##..",
			".#.####..",
			"...#.##..",
			"#..######",
		},
		{
			".##..####..",
			".##..####..",
			"#...#.##.#.",
			"#...#....#.",
			"#.....###..",
			"....##..##.",
			".#####..###",
		},
		{
			"####..#.#####",
			"...######....",
			"#..#.##.#..##",
			"#####..######",
			"#.###..###.##",
			"##........###",
			"..##....##...",
			"###..##..####",
			"##...##...###",
			"##..#..#..###",
			".#.######.#..",
			"..#......#...",
			"..#.#..#.#...",
			"####....#####",
			"##.##..##.###",
		},
		{
			"##.#....##.......",
			".#...#####.######",
			"#....#..#..#.##.#",
			".###..##..#......",
			"#####.#..#.......",
			".#....#.###.#..#.",
			"..#.###.##.......",
			"...#...#.#..####.",
			"###.##...##......",
			".#.#...######..##",
			".#.##..######..##",
		},
		{
			".##..##..",
			".##..##..",
			"#..###...",
			".#...#...",
			"##.#..#..",
			"#..#..###",
			"....#....",
			".######..",
			".##.#.#..",
			"##.#.##..",
			"...##...#",
			"###..#.##",
			"#.###..##",
			"##.####..",
			".####.###",
		},
		{
			"..####...##",
			"..##.#.#...",
			"..##.#.#...",
			"..####....#",
			"...####.#..",
			"....#.#...#",
			"...#..#....",
			"##...#.....",
			"..#.###.###",
			"...#####.#.",
			"#####..#...",
		},
		{
			"#####.#....#.",
			"#####......#.",
			"#.######.#.##",
			"#.######.#.##",
			"#####......#.",
			"#####.#....#.",
			"##..#.#...#.#",
			"##..#.#....##",
			".#####.##.###",
			".#.#...#.##.#",
			"#.#.#####..##",
		},
		{
			"#...########.#.##",
			"#...########.#.##",
			".....###.#.#...##",
			"..##..#.#.##.###.",
			"###.#.#.###.###.#",
			"..#..#.....###...",
			"##.#.#.#.....##..",
			".##.##.##.####.#.",
			"#..##.#..#.####..",
			"#..##.#..#.####..",
			".##.##.##.####.#.",
			"##.#.#.#.....##..",
			"..#..#.....###...",
			"###.#.#.###.###.#",
			"..##..#.#..#.###.",
			".....###.#.#...##",
			"#...########.#.##",
		},
		{
			"####..####.",
			"####.#..#..",
			"....#..###.",
			"####..###..",
			"...##.#####",
			"..##..##..#",
			"##...#..#..",
			"####..##.##",
			"###...##.##",
			"##.####..##",
			"####......#",
			"...#.....#.",
			"...#.....#.",
			"####.#....#",
			"##.####..##",
		},
		{
			"...#....##..#",
			"......#.#..##",
			"....#..##...#",
			"....##.###.#.",
			"##...###...#.",
			"###.###....#.",
			".....####..##",
			"..####..#..#.",
			"..##..##.#.##",
			"..##.......#.",
			"...####.....#",
			"..######.##.#",
			"...#####.##.#",
		},
		{
			".#.##.#...#..",
			"...##...##.#.",
			"#.####.##.#.#",
			"#.####.##.###",
			"...##...##.#.",
			".#.##.#...#..",
			"..........#..",
		},
		{
			"##.##..#..#",
			"#.##.####..",
			"..##....###",
			"#....##..##",
			"...#...##.#",
			"#.#..#.#.#.",
			"##....####.",
			"..#..###.##",
			"..#..###.##",
			"##....####.",
			"#.#..#.#.#.",
			"...#...##.#",
			"#.#..##..##",
			"..##....###",
			"#.##.####..",
			"##.##..#..#",
			"##.##..#..#",
		},
		{
			"...#.##.#.....#..",
			"...#.##.#.....#..",
			"#....###.#.###.##",
			".#####.##.#.#..#.",
			"##..###.##..###..",
			"#.#####.##.#....#",
			"...#....#..##.##.",
			"...#....#..##.##.",
			"#.#####.##.#....#",
			"#...###.##..###..",
			".#####.##.#.#..#.",
		},
		{
			"#.##.##.##.##",
			"#...####...##",
			"#.##....#####",
			"###......####",
			".#.#.##.#.#..",
			"###..##..####",
			"#.###..###.##",
		},
		{
			"##.#####.#####...",
			"##.#.#####...####",
			"..#..##.#.#.##.#.",
			"###.#....##.#....",
			"..##.#...........",
			"####.#.##..#....#",
			".####..#..#...##.",
			"###..####.#.##.#.",
			"#######..#...#...",
			"######..#....##..",
			"..###.#.##.......",
			"...#.####...###.#",
			"...#.####...###.#",
		},
		{
			"########.#.#..#",
			"##.#..##..####.",
			"#####..#.......",
			"####.##..#.####",
			"#..#.##.###.#..",
			".....#.#.#.####",
			"#####....#...#.",
			"#####.#.......#",
			".##...#..#.#...",
			".##...#..#.#...",
			"#####.#.......#",
		},
	}
)

func transpose(graph []string) []string {
	size := len(graph[0])
	transposed := make([][]byte, size)
	//fmt.Printf("Original\n")
	for i := 0; i < size; i++ {
		transposed[i] = make([]byte, len(graph))
	}
	for i, line := range graph {
		//fmt.Printf("%s\n", graph[i])
		for j := 0; j < size; j++ {
			transposed[j][i] = line[j]
		}
	}
	//fmt.Printf("Transposed\n")
	graph = make([]string, size)
	for i := 0; i < size; i++ {
		graph[i] = string(transposed[i])
		//fmt.Printf("%s\n", graph[i])
	}
	return graph
}

func compareLines(line1, line2 string, fixAllowed bool) (bool, bool) {
	if line1 == line2 {
		return true, false
	}
	if fixAllowed {
		errorCount := 0
		for c := 0; c < len(line1); c++ {
			if line1[c] != line2[c] {
				errorCount++
			}
		}
		if errorCount == 1 {
			return true, true
		}
	}
	return false, false
}

func computeScore(graph []string, v bool, fixRequired bool) (int, bool) {
	index := -1
	fixDone := false
SearchAxis:
	for i := 0; i < len(graph)-1; i++ {
		same, fixAxisRequired := compareLines(graph[i], graph[i+1], fixRequired)
		if same {
			fixDone = fixAxisRequired
			index = i
			for j := -1; j >= -index; j-- {
				if index+1-j == len(graph) {
					break
				}
				same, fixed := compareLines(graph[index+j], graph[index+1-j], fixRequired && !fixDone)
				fixDone = fixDone || fixed
				if !same {
					index = -1
					fixDone = false
					continue SearchAxis
				}
			}
			if !fixRequired || fixDone {
				break SearchAxis
			}
		}
	}
	if !v && (index == -1 || (fixRequired && !fixDone)) {
		return computeScore(transpose(graph), !v, fixRequired)
	}

	if v && index != -1 {
		fmt.Printf("vertical %d - %v\n", index+1, fixDone)
		return (index + 1), fixDone
	}
	fmt.Printf("horizontal %d - %v\n", index+1, fixDone)
	return 100 * (index + 1), fixDone
}

func computeSymetryScore(input [][]string, fixRequired bool) {
	score := 0
	for _, graph := range input {
		graphScore, fixDone := computeScore(graph, false, fixRequired)
		if !fixDone {
			graphScore, fixDone = computeScore(graph, false, fixRequired)
		}
		if !fixRequired || fixDone {
			score += graphScore
		}
	}
	fmt.Printf("Final score: %d\n", score)
}

func TestTranspose(t *testing.T) {
	for _, graph := range largeInput {
		transposed := transpose(transpose(graph))
		for i := range graph {
			if graph[i] != transposed[i] {
				panic("transpose failed")
			}
		}
	}
}

func TestDay13Phase1(t *testing.T) {
	// 405
	computeSymetryScore(lightInput, false)
	// 41859
	computeSymetryScore(largeInput, false)
}

func TestDay13Phase2(t *testing.T) {
	// 400
	computeSymetryScore(lightInput, true)
	// 30842
	computeSymetryScore(largeInput, true)
}
